# Analysis: dma-mapping: migrate to physical address-based API

**Generated**: 2025-08-27 17:05:56
**Series ID**: 991437
**Author**: Leon Romanovsky
**Date**: 2025-08-14
**Patches**: 16
**Patchwork URL**: https://patchwork.kernel.org/project/rust-for-linux/list/?series=991437

---

# Executive Brief: dma-mapping: migrate to physical address-based API

**Status**: Under review  
**Significance**: Infrastructure

## What & Why
This patchset modernizes the DMA mapping subsystem to use physical addresses instead of page pointers, primarily to support peer-to-peer DMA operations where devices transfer data directly between each other (bypassing system memory). While not Rust-specific, this infrastructure work enables safer memory management abstractions that Rust drivers will eventually need for high-performance device interactions.

## Technical Context
The DMA mapping layer sits between device drivers and the IOMMU/memory management subsystems, translating between device-visible addresses and system memory. Currently, the API assumes all DMA targets are normal system RAM accessible via `struct page` pointers. This breaks down for peer-to-peer scenarios where devices want to DMA directly to/from other devices' memory-mapped registers or on-device memory.

The key changes introduce `DMA_ATTR_MMIO` to flag non-cacheable, non-system memory addresses and refactor internal functions from page-based to physical address-based operations. This affects tracing (`trace_dma_*map_page` → `trace_dma_*map_phys`) and IOMMU driver interfaces (`iommu_dma_*map_page` → `iommu_dma_*map_phys`). The work enables proper handling of GPU memory, NVMe peer-to-peer transfers, and similar high-performance scenarios that bypass CPU involvement.

For Rust-for-Linux, this provides cleaner abstractions where physical addresses are explicitly typed and separated from page-based memory, reducing the likelihood of incorrect assumptions about memory properties in safe Rust wrappers.

## Issues & Conflicts
Minor documentation issues flagged by Randy Dunlap regarding spelling ("cacheable" vs "cachable") but author is responsive. The patchset shows limited community engagement (only 2 comments, 1 reviewer) despite being posted 13 days ago, which may indicate either broad acceptance or insufficient review attention for infrastructure changes of this scope.